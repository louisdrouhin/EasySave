<?xml version="1.0" encoding="UTF-8"?>
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:EasySave.Gui.ViewModels"
             xmlns:comp="clr-namespace:EasySave.GUI.Components"
             x:Class="EasySave.GUI.Components.JobCard"
             x:DataType="vm:JobViewModel">
    <UserControl.Resources>
        <Geometry x:Key="ChevronRightIcon">M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z</Geometry>
        <Geometry x:Key="ChevronDownIcon">M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z</Geometry>
        <Geometry x:Key="PlayIcon">M8,5.14V19.14L19,12.14L8,5.14Z</Geometry>
        <Geometry x:Key="PauseIcon">M14,19H18V5H14M6,19H10V5H6V19Z</Geometry>
        <Geometry x:Key="StopIcon">M18,18H6V6H18V18Z</Geometry>
        <Geometry x:Key="TrashIcon">M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z</Geometry>
        <Geometry x:Key="CheckIcon">M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z</Geometry>
        <Geometry x:Key="CancelIcon">M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z</Geometry>
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="Button#ToggleButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="CornerRadius" Value="0"/>
        </Style>
        <Style Selector="Button#ToggleButton:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="Transparent"/>
        </Style>
        <Style Selector="Button.button-play-green:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#16A34A" />
        </Style>
        <Style Selector="Button.button-play-green:pointerover">
            <Setter Property="Foreground" Value="White" />
        </Style>
    </UserControl.Styles>

    <Border BorderBrush="#E0E0E0"
            BorderThickness="1"
            CornerRadius="10"
            ClipToBounds="True"
            Background="#FFFFFF">
        <StackPanel Spacing="0">
            
            <Border Padding="10,15" Background="Transparent">
                <Grid ColumnDefinitions="30,45,*,Auto,38,38" VerticalAlignment="Center">
                    <Button x:Name="ToggleButton"
                            Command="{Binding ToggleExpandCommand}"
                            Grid.Column="0"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="0"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center">
                        <PathIcon Data="{Binding IsExpanded, Converter={StaticResource BoolToGeometryConverter}}"
                                  Width="12"
                                  Height="12"
                                  Foreground="#6B7280"/>
                    </Button>

                    <comp:CustomCheckBox Grid.Column="1"
                                         IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                         VerticalAlignment="Center"
                                         HorizontalAlignment="Center"
                                         Margin="4,0" />

                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center" Margin="10,0,0,0">
                        <TextBlock Text="{Binding Name}"
                                   FontSize="15"
                                   FontWeight="Bold"
                                   Foreground="#15171D"
                                   VerticalAlignment="Center"/>
                        
                        <Border CornerRadius="6"
                                Padding="8,4"
                                Background="{Binding Job.Type, Converter={StaticResource JobTypeColorConverter}}"
                                VerticalAlignment="Center">
                            <TextBlock Text="{Binding TypeLabel}"
                                       Foreground="White"
                                       FontSize="11"
                                       FontWeight="Bold" />
                        </Border>
                    </StackPanel>

                    <Border Grid.Column="3"
                            CornerRadius="6"
                            Padding="8,4"
                            Background="{Binding StatusBadgeColor}"
                            VerticalAlignment="Center"
                            Margin="0,0,10,0">
                        <TextBlock Text="{Binding StatusLabel}"
                                   Foreground="White"
                                   FontSize="11"
                                   FontWeight="Bold" />
                    </Border>

                    <!-- Play/Pause Button (hidden when confirming delete) -->
                    <Button Grid.Column="4"
                            Command="{Binding PlayPauseResumeCommand}"
                            IsVisible="{Binding !IsDeleteConfirming}"
                            Width="30"
                            Height="30"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Background="{Binding PlayButtonBackground}"
                            Foreground="White"
                            BorderThickness="0"
                            CornerRadius="6"
                            Padding="0"
                            Margin="0,0,5,0"
                            Classes="button-play-green">
                        <PathIcon Data="{Binding PlayPauseIconData}" Width="10" Height="10" Foreground="White" Margin="2,0,0,0"/>
                    </Button>

                    <!-- Delete Button (hidden when confirming delete) -->
                    <Button Grid.Column="5"
                            Command="{Binding DeleteCommand}"
                            IsVisible="{Binding !IsDeleteConfirming}"
                            Width="30"
                            Height="30"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Classes="button-red"
                            Padding="0">
                        <PathIcon Data="{Binding DeleteIconData}" Width="14" Height="14" Foreground="White"/>
                    </Button>

                    <!-- Cancel Delete Button (visible when confirming delete) -->
                    <Button Grid.Column="4"
                            Command="{Binding CancelDeleteCommand}"
                            IsVisible="{Binding IsDeleteConfirming}"
                            Width="30"
                            Height="30"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Classes="button-gray-cancel"
                            Padding="0"
                            Margin="0,0,5,0">
                        <PathIcon Data="{StaticResource CancelIcon}" Width="12" Height="12" Foreground="#6B7280"/>
                    </Button>

                    <!-- Confirm Delete Button (visible when confirming delete) -->
                    <Button Grid.Column="5"
                            Command="{Binding ConfirmDeleteCommand}"
                            IsVisible="{Binding IsDeleteConfirming}"
                            Width="30"
                            Height="30"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Classes="button-red"
                            Padding="0">
                        <PathIcon Data="{StaticResource CheckIcon}" Width="14" Height="14" Foreground="White"/>
                    </Button>
                </Grid>
            </Border>

            <Border IsVisible="{Binding IsProgressVisible}"
                    BorderBrush="#E0E0E0"
                    BorderThickness="0,1,0,0"
                    Padding="15,15,15,15"
                    Background="#FFFFFF">
                 <StackPanel Spacing="8">
                     <Grid ColumnDefinitions="*,Auto">
                         <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="In Progress" FontWeight="Bold" FontSize="10" Foreground="#22C55E" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding StatusLabel}" FontSize="11" Foreground="#6B7280" VerticalAlignment="Center"/>
                         </StackPanel>
                         <TextBlock Text="{Binding ProgressText}" FontWeight="Bold" FontSize="12" Foreground="#15171D" Grid.Column="1"/>
                     </Grid>

                     <ProgressBar Value="{Binding Progress}" Minimum="0" Maximum="100" Height="6" Foreground="#22C55E" Background="#E5E7EB"/>

                     <Grid ColumnDefinitions="*,*">
                         <StackPanel Spacing="2" HorizontalAlignment="Right" Margin="0,0,20,0">
                            <TextBlock Text="Files" FontSize="10" FontWeight="Bold" Foreground="#9CA3AF" TextAlignment="Right"/>
                            <TextBlock Text="{Binding RemainingFilesText}" FontSize="11" Foreground="#1F2937" TextAlignment="Right"/>
                         </StackPanel>

                         <StackPanel Grid.Column="1" Spacing="2" HorizontalAlignment="Right">
                            <TextBlock Text="Size" FontSize="10" FontWeight="Bold" Foreground="#9CA3AF" TextAlignment="Right"/>
                            <TextBlock Text="{Binding RemainingSizeText}" FontSize="11" Foreground="#1F2937" TextAlignment="Right"/>
                         </StackPanel>
                     </Grid>
                 </StackPanel>
            </Border>

            <Border x:Name="DetailsPanel"
                    IsVisible="{Binding IsExpanded}"
                    BorderBrush="#E0E0E0"
                    BorderThickness="0,1,0,0"
                    Padding="15"
                    Background="#FAFAFA">
                <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*">
                    <TextBlock Grid.Row="0"
                               Grid.Column="0"
                               Text="Source:"
                               Foreground="#666666"
                               FontSize="12"
                               FontWeight="Bold" />
                    <TextBlock Grid.Row="0"
                               Grid.Column="1"
                               Text="{Binding SourcePath}"
                               Foreground="#15171D"
                               FontSize="12"
                               TextWrapping="Wrap"
                               TextTrimming="CharacterEllipsis"
                               Margin="10,0,0,0" />

                    <TextBlock Grid.Row="1"
                               Grid.Column="0"
                               Text="Destination:"
                               Foreground="#666666"
                               FontSize="12"
                               FontWeight="Bold"
                               Margin="0,8,0,0" />

                    <TextBlock Grid.Row="1"
                               Grid.Column="1"
                               Text="{Binding DestinationPath}"
                               Foreground="#15171D"
                               FontSize="12"
                               TextWrapping="Wrap"
                               TextTrimming="CharacterEllipsis"
                               Margin="10,8,0,0" />
                </Grid>
            </Border>
        </StackPanel>
    </Border>
</UserControl>